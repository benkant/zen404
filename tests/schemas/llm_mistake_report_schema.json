{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LLM Mistake Report",
  "description": "A structured report detailing an LLM mistake, its analysis, and remediation.",
  "type": "object",
  "properties": {
    "report_id": {
      "description": "Unique identifier for this report.",
      "type": "string",
      "format": "uuid"
    },
    "report_timestamp": {
      "description": "Timestamp of when the report was generated.",
      "type": "string",
      "format": "date-time"
    },
    "reporter_id": {
      "description": "Identifier for the entity reporting the mistake (e.g., LLM instance name).",
      "type": "string"
    },
    "overall_task_description": {
      "description": "A summary of the overall task the LLM was attempting.",
      "type": "string"
    },
    "overall_user_prompt_summary": {
      "description": "A summary of the user's prompt that led to the mistake context.",
      "type": "string"
    },
    "overall_llm_action_summary": {
      "description": "A summary of the LLM's actions related to the mistake context.",
      "type": "string"
    },
    "overall_severity": {
      "description": "The overall severity assessment of the mistake(s) in this report.",
      "type": "string",
      "enum": ["Critical", "Major", "Minor", "Trivial", "Informational"]
    },
    "issues": {
      "description": "An array of specific issues identified (these are the granular 'items').",
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/issueDetail"
      }
    },
    "remediations": {
      "description": "An array of remediations applied or suggested.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/remediationDetail"
      }
    },
    "tool_interactions": {
      "description": "Optional details of tool interactions relevant to the mistake.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/toolInteraction"
      }
    },
    "attachments": {
      "description": "Optional attachments relevant to the report (e.g., file diffs, logs).",
      "type": "array",
      "items": {
        "$ref": "#/definitions/attachment"
      }
    },
    "report_metadata": {
        "description": "Any other arbitrary metadata for the report, as a key-value map.",
        "type": "object",
        "additionalProperties": true
    }
  },
  "required": [
    "report_id",
    "report_timestamp",
    "reporter_id",
    "overall_task_description",
    "issues",
    "overall_severity"
  ],
  "additionalProperties": false,
  "definitions": {
    "issueDetail": {
      "description": "Details of a specific issue.",
      "type": "object",
      "properties": {
        "issue_id": {
          "description": "Unique identifier for this specific issue.",
          "type": "string",
          "format": "uuid"
        },
        "mistake_type": {
          "description": "Categorization of the mistake type(s).",
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": [
              "SchemaViolation", "InstructionNotFollowed", "Misunderstanding",
              "ToolErrorHandling", "IncorrectAssumption", "FactualError",
              "FormattingError", "IncompleteResponse", "LogicalError", "Other"
            ]
          }
        },
        "mistake_description": {
          "description": "Detailed description of the mistake made for this issue.",
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        },
        "expected_behavior_points": {
          "description": "What the expected behavior or outcome was (in point form).",
          "type": "array",
          "items": {"type": "string"}
        },
        "actual_behavior_points": {
          "description": "What the actual behavior or outcome was (in point form).",
          "type": "array",
          "items": {"type": "string"}
        },
        "severity_per_issue": {
          "description": "Severity assessment for this specific issue.",
          "type": "string",
          "enum": ["Critical", "Major", "Minor", "Trivial", "Informational"]
        },
        "context_snippets": {
          "description": "Optional code snippets or text excerpts providing context for the issue.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/contextSnippet"
          }
        }
      },
      "required": [
        "issue_id",
        "mistake_type",
        "mistake_description",
        "severity_per_issue"
      ],
      "additionalProperties": false
    },
    "remediationDetail": {
      "description": "Details of a remediation action or plan.",
      "type": "object",
      "properties": {
        "remediation_id": {
          "description": "Unique identifier for this remediation.",
          "type": "string",
          "format": "uuid"
        },
        "applies_to_issue_ids": {
          "description": "Array of issue_ids that this remediation addresses.",
          "type": "array",
          "items": {"type": "string", "format": "uuid"}
        },
        "root_cause_analysis_points": {
          "description": "Analysis of the root cause (in point form).",
          "type": "array",
          "items": {"type": "string"}
        },
        "correction_strategy_points": {
          "description": "Strategy or steps taken/proposed for correction (in point form).",
          "type": "array",
          "items": {"type": "string"}
        },
        "learning_points": {
          "description": "Key learnings or takeaways from this mistake and remediation (in point form).",
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "required": [
        "remediation_id",
        "applies_to_issue_ids"
      ],
      "additionalProperties": false
    },
    "toolInteraction": {
      "description": "Record of a tool interaction.",
      "type": "object",
      "properties": {
        "tool_name": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "input_summary": {"type": "object", "additionalProperties": true},
        "output_summary": {"type": "object", "additionalProperties": true},
        "status": {"type": "string", "enum": ["success", "failure"]}
      },
      "required": ["tool_name", "timestamp", "status"],
      "additionalProperties": false
    },
    "attachment": {
      "description": "An attached file or piece of data.",
      "type": "object",
      "properties": {
        "filename": {"type": "string"},
        "content_type": {"type": "string"},
        "data_or_link": {"type": "string"}
      },
      "required": ["filename", "content_type", "data_or_link"],
      "additionalProperties": false
    },
    "contextSnippet": {
      "description": "A snippet of text or code for context.",
      "type": "object",
      "properties": {
        "source_identifier": {"description": "e.g., file path, URL", "type": "string"},
        "snippet": {"type": "string"},
        "line_range": {"description": "Optional, e.g., L10-L15", "type": "string"}
      },
      "required": ["snippet"],
      "additionalProperties": true
    }
  }
}
